<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Inscrição de Encontristas • ECC</title>
  <link rel="stylesheet" href="estilos.css">
</head>

<body>

  <button class="logout-btn" onclick="logout()">Sair</button>
  <br><br>

  <!-- Navegação -->
  <button class="nav-btn" onclick="goTo('dashboard')">Dashboard</button>
  <button class="nav-btn" onclick="goTo('eventos')">Eventos</button>
  <button class="nav-btn" onclick="goTo('equipes')">Equipes</button>
  <button class="nav-btn" onclick="goTo('equipes_evento')">Evento x Equipe</button>
  <button class="nav-btn" onclick="goTo('encontreiro')">Encontreiro</button>
  <button class="nav-btn" onclick="goTo('pessoas')">Pessoas</button>
  <button class="nav-btn" onclick="goTo('pessoa_equipe')">Pessoas x Equipe</button>
  <button class="nav-btn" onclick="goTo('inscricoes')">Inscrições</button>

  <h1>Ficha de Inscrição de Encontristas</h1>

  <div class="card">
    <form id="formInscricao" onsubmit="salvarInscricao(event)">

      <!-- ===================== ETAPA 1 - ESPOSO ====================== -->
      <div class="step active" id="step1">
        <h2>1️⃣ Dados do Esposo</h2>

        <label>Nome Completo</label>
        <input id="nome_completo_esposo" required>

        <label>Data de Nascimento</label>
        <input type="date" id="data_nascimento_esposo" required>

        <label>Profissão</label>
        <input id="profissao_esposo">

        <label>Como deseja ser chamado?</label>
        <input id="como_chamar_esposo">

        <label>Igreja</label>
        <input id="igreja_esposo">

        <label>Local de Trabalho</label>
        <input id="local_trabalho_esposo">

        <label>Celular</label>
        <input id="celular_esposo">

        <label>Instagram/Facebook</label>
        <input id="instagram_esposo">

        <label>Restrições Alimentares</label>
        <input id="restricoes_alimentares_esposo">

        <label>Medicamentos / Alergias</label>
        <input id="medicamentos_alergias_esposo">

        <label>Religião</label>
        <select id="religiao_esposo">
          <option value="">Selecione</option>
          <option value="catolico">Católico</option>
          <option value="evangelico">Evangélico</option>
          <option value="espirita">Espírita</option>
          <option value="outro">Outro</option>
          <option value="nenhuma">Nenhuma</option>
        </select>

        <label>Escolaridade</label>
        <select id="escolaridade_esposo">
          <option value="">Selecione</option>
          <option value="fundamental">Fundamental</option>
          <option value="medio">Ensino Médio</option>
          <option value="superior">Ensino Superior</option>
          <option value="nenhuma">Nenhuma</option>
        </select>

        <br><br>
        <button type="button" class="btnNav" onclick="nextStep()">Próximo ➜</button>
      </div>

      <!-- ===================== ETAPA 2 - ESPOSA ====================== -->
      <div class="step" id="step2">
        <h2>2️⃣ Dados da Esposa</h2>

        <label>Nome Completo</label>
        <input id="nome_completo_esposa" required>

        <label>Data de Nascimento</label>
        <input type="date" id="data_nascimento_esposa" required>

        <label>Profissão</label>
        <input id="profissao_esposa">

        <label>Como deseja ser chamada?</label>
        <input id="como_chamar_esposa">

        <label>Igreja</label>
        <input id="igreja_esposa">

        <label>Local de Trabalho</label>
        <input id="local_trabalho_esposa">

        <label>Celular</label>
        <input id="celular_esposa">

        <label>Instagram/Facebook</label>
        <input id="instagram_esposa">

        <label>Restrições Alimentares</label>
        <input id="restricoes_alimentares_esposa">

        <label>Medicamentos / Alergias</label>
        <input id="medicamentos_alergias_esposa">

        <label>Religião</label>
        <select id="religiao_esposa">
          <option value="">Selecione</option>
          <option value="catolico">Católico</option>
          <option value="evangelico">Evangélico</option>
          <option value="espirita">Espírita</option>
          <option value="outro">Outro</option>
          <option value="nenhuma">Nenhuma</option>
        </select>

        <label>Escolaridade</label>
        <select id="escolaridade_esposa">
          <option value="">Selecione</option>
          <option value="fundamental">Fundamental</option>
          <option value="medio">Ensino Médio</option>
          <option value="superior">Ensino Superior</option>
          <option value="nenhuma">Nenhuma</option>
        </select>

        <br><br>
        <button type="button" class="btnNav" onclick="prevStep()">⬅ Voltar</button>
        <button type="button" class="btnNav" onclick="nextStep()">Próximo ➜</button>
      </div>

      <!-- ===================== ETAPA 3 - DADOS DO CASAL ====================== -->
      <div class="step" id="step3">
        <h2>3️⃣ Dados do Casal</h2>

        <label>Endereço</label>
        <input id="endereco">

        <label>Número</label>
        <input id="numero">

        <label>Complemento</label>
        <input id="complemento">

        <label>Bairro</label>
        <input id="bairro">

        <label>Cidade</label>
        <input id="cidade">

        <label>UF</label>
        <input id="uf">

        <label>CEP</label>
        <input id="cep">

        <label>Data de Casamento</label>
        <input type="date" id="data_casamento">

        <label>Telefone</label>
        <input id="telefone_principal">

        <label>Email</label>
        <input id="email">

        <label>Possui filhos?</label>
        <select id="possui_filhos">
          <option value="false">Não</option>
          <option value="true">Sim</option>
        </select>

        <label>Quantidade de filhos</label>
        <input type="number" id="quantidade_filhos" min="0">

        <h3>Responsável pelos filhos</h3>
        <label>Nome</label>
        <input id="nome_responsavel_filhos">

        <label>Telefone</label>
        <input id="telefone_responsavel">

        <label>Casal que convidou</label>
        <input id="casal_que_convidou">

        <label>Telefone do casal que convidou</label>
        <input id="telefone_casal_que_convidou">

        <br><br>
        <button type="button" class="btnNav" onclick="prevStep()">⬅ Voltar</button>
        <button type="submit">Enviar Inscrição ✔</button>
      </div>

    </form>
  </div>

  <script src="../config.js"></script>
  <script>
    // --------- auth / navegação igual outras telas ----------
    const token = localStorage.getItem("token");
    if (!token) window.location.href = "./auth-login.html";

    function logout() {
      localStorage.removeItem("token");
      window.location.href = "./auth-login.html";
    }

    function goTo(page) {
      window.location.href = `${page}.html`;
    }

    // --------- multi-step ----------
    let currentStep = 1;

    function showStep(n) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      const step = document.getElementById('step' + n);
      if (step) step.classList.add('active');
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function nextStep() {
      if (currentStep < 3) {
        currentStep++;
        showStep(currentStep);
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
      }
    }

    // --------- envio para o backend ----------
    const API_ENCONTRISTA_INSCR = `${APP_CONFIG.API_BASE_URL}/encontrista_inscricao`;

    async function salvarInscricao(event) {
      event.preventDefault();

      const payload = {
        // esposo
        nome_completo_esposo: document.getElementById("nome_completo_esposo").value,
        data_nascimento_esposo: document.getElementById("data_nascimento_esposo").value,
        profissao_esposo: document.getElementById("profissao_esposo").value,
        como_chamar_esposo: document.getElementById("como_chamar_esposo").value,
        igreja_esposo: document.getElementById("igreja_esposo").value,
        local_trabalho_esposo: document.getElementById("local_trabalho_esposo").value,
        celular_esposo: document.getElementById("celular_esposo").value,
        instagram_esposo: document.getElementById("instagram_esposo").value,
        restricoes_alimentares_esposo: document.getElementById("restricoes_alimentares_esposo").value,
        medicamentos_alergias_esposo: document.getElementById("medicamentos_alergias_esposo").value,
        religiao_esposo: document.getElementById("religiao_esposo").value,
        escolaridade_esposo: document.getElementById("escolaridade_esposo").value,

        // esposa
        nome_completo_esposa: document.getElementById("nome_completo_esposa").value,
        data_nascimento_esposa: document.getElementById("data_nascimento_esposa").value,
        profissao_esposa: document.getElementById("profissao_esposa").value,
        como_chamar_esposa: document.getElementById("como_chamar_esposa").value,
        igreja_esposa: document.getElementById("igreja_esposa").value,
        local_trabalho_esposa: document.getElementById("local_trabalho_esposa").value,
        celular_esposa: document.getElementById("celular_esposa").value,
        instagram_esposa: document.getElementById("instagram_esposa").value,
        restricoes_alimentares_esposa: document.getElementById("restricoes_alimentares_esposa").value,
        medicamentos_alergias_esposa: document.getElementById("medicamentos_alergias_esposa").value,
        religiao_esposa: document.getElementById("religiao_esposa").value,
        escolaridade_esposa: document.getElementById("escolaridade_esposa").value,

        // casal
        endereco: document.getElementById("endereco").value,
        numero: document.getElementById("numero").value,
        complemento: document.getElementById("complemento").value,
        bairro: document.getElementById("bairro").value,
        cidade: document.getElementById("cidade").value,
        uf: document.getElementById("uf").value,
        cep: document.getElementById("cep").value,
        data_casamento: document.getElementById("data_casamento").value,
        telefone_principal: document.getElementById("telefone_principal").value,
        email: document.getElementById("email").value,
        possui_filhos: document.getElementById("possui_filhos").value === "true",
        quantidade_filhos: document.getElementById("quantidade_filhos").value
          ? parseInt(document.getElementById("quantidade_filhos").value, 10)
          : null,

        nome_responsavel_filhos: document.getElementById("nome_responsavel_filhos").value,
        telefone_responsavel: document.getElementById("telefone_responsavel").value,
        casal_que_convidou: document.getElementById("casal_que_convidou").value,
        telefone_casal_que_convidou: document.getElementById("telefone_casal_que_convidou").value
      };

      const res = await fetch(API_ENCONTRISTA_INSCR, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token
        },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        const erro = await res.json().catch(() => ({}));
        alert(erro.error || "Erro ao salvar inscrição");
        return;
      }

      alert("Inscrição enviada com sucesso!");
      document.getElementById("formInscricao").reset();
      currentStep = 1;
      showStep(currentStep);
    }

    // garantir que começa na etapa 1
    showStep(currentStep);
  </script>

</body>

</html>