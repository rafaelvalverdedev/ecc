<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pagamento PIX - ECC</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      background: #f2f2f2;
      padding-top: 40px;
    }
    #qrcode {
      margin-top: 20px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      display: inline-block;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .status {
      font-size: 20px;
      margin-top: 30px;
      color: #444;
    }
  </style>
</head>
<body>

  <h1>Pagamento PIX</h1>
  <p>Escaneie o QR Code abaixo:</p>

  <div id="qrcode">
    <img id="qrcode-img" width="260">
  </div>

  <div class="status" id="status-text">Aguardando pagamento...</div>

  <script>
    // Ler parÃ¢metros da URL
    const params = new URLSearchParams(window.location.search);
    const inscricaoId = params.get("inscricao");
    const qr = params.get("qr"); // Base64 vindo do backend

    document.getElementById("qrcode-img").src = qr;

    async function verificarPagamento() {
      const resp = await fetch(`https://ecc-backend-8i9l.onrender.com/inscricoes/public/${inscricaoId}`)

      const dados = await resp.json();

      if (dados.status === "pago") {
        document.getElementById("status-text").innerText = "ðŸŽ‰ Pagamento confirmado!";
        setTimeout(() => {
          window.location.href = "/confirmado.html";
        }, 2000);
      }
    }

    // Verificar a cada 4 segundos
    setInterval(verificarPagamento, 4000);
  </script>

</body>
</html>
